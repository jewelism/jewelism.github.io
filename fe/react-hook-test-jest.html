<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>React Hook Test with Jest | Jewelry Blog</title>
    <meta name="generator" content="VuePress 1.9.10">
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-NG6SBMZL');</script>
    <link rel="icon" href="/images/logo.png">
    <meta name="description" content="dev blog">
    <meta property="og:title" content="Jewelry Blog">
    <meta property="og:description" content="dev blog">
    <meta name="naver-site-verification" property="naver-site-verification" content="5b2f37c7b4199869388745a2b48d71230f79701b">
    
    <link rel="preload" href="/assets/css/0.styles.7b19a011.css" as="style"><link rel="preload" href="/assets/js/app.d8edd250.js" as="script"><link rel="preload" href="/assets/js/2.b813d316.js" as="script"><link rel="preload" href="/assets/js/1.63ec6906.js" as="script"><link rel="preload" href="/assets/js/70.c38e5f80.js" as="script"><link rel="prefetch" href="/assets/js/10.68915e8a.js"><link rel="prefetch" href="/assets/js/100.d48fb8d1.js"><link rel="prefetch" href="/assets/js/101.b5ebbd9c.js"><link rel="prefetch" href="/assets/js/102.982f90cb.js"><link rel="prefetch" href="/assets/js/103.c96dc806.js"><link rel="prefetch" href="/assets/js/104.f1a3e6c7.js"><link rel="prefetch" href="/assets/js/105.bee66f51.js"><link rel="prefetch" href="/assets/js/106.d4e221ac.js"><link rel="prefetch" href="/assets/js/107.17fa7b87.js"><link rel="prefetch" href="/assets/js/108.036293f3.js"><link rel="prefetch" href="/assets/js/109.f902e0bc.js"><link rel="prefetch" href="/assets/js/11.90e8c648.js"><link rel="prefetch" href="/assets/js/110.23cf18f3.js"><link rel="prefetch" href="/assets/js/111.25a08651.js"><link rel="prefetch" href="/assets/js/112.b575ba09.js"><link rel="prefetch" href="/assets/js/113.39d46774.js"><link rel="prefetch" href="/assets/js/114.54b1d77d.js"><link rel="prefetch" href="/assets/js/115.49ad11c7.js"><link rel="prefetch" href="/assets/js/116.d1eb4002.js"><link rel="prefetch" href="/assets/js/117.641cbc64.js"><link rel="prefetch" href="/assets/js/118.8c20b0ee.js"><link rel="prefetch" href="/assets/js/119.5e1499c4.js"><link rel="prefetch" href="/assets/js/12.566e820c.js"><link rel="prefetch" href="/assets/js/120.bd6dbcbf.js"><link rel="prefetch" href="/assets/js/121.fdb8d482.js"><link rel="prefetch" href="/assets/js/122.2b358183.js"><link rel="prefetch" href="/assets/js/123.47da7d6f.js"><link rel="prefetch" href="/assets/js/124.25f4b64b.js"><link rel="prefetch" href="/assets/js/125.3600f35d.js"><link rel="prefetch" href="/assets/js/126.bf9c3ab6.js"><link rel="prefetch" href="/assets/js/127.2a668d3c.js"><link rel="prefetch" href="/assets/js/128.f6e7d7a4.js"><link rel="prefetch" href="/assets/js/129.de543284.js"><link rel="prefetch" href="/assets/js/13.7d78815a.js"><link rel="prefetch" href="/assets/js/130.b8eb138d.js"><link rel="prefetch" href="/assets/js/131.df799559.js"><link rel="prefetch" href="/assets/js/132.87f8fdd2.js"><link rel="prefetch" href="/assets/js/133.1ecedbc9.js"><link rel="prefetch" href="/assets/js/134.050b3131.js"><link rel="prefetch" href="/assets/js/135.67fab777.js"><link rel="prefetch" href="/assets/js/136.5606edf6.js"><link rel="prefetch" href="/assets/js/137.e66661fb.js"><link rel="prefetch" href="/assets/js/138.f9436bbb.js"><link rel="prefetch" href="/assets/js/139.8ea1d596.js"><link rel="prefetch" href="/assets/js/14.a384c04f.js"><link rel="prefetch" href="/assets/js/140.ac02ebc5.js"><link rel="prefetch" href="/assets/js/141.14b29649.js"><link rel="prefetch" href="/assets/js/142.e57ed7db.js"><link rel="prefetch" href="/assets/js/143.06f2348c.js"><link rel="prefetch" href="/assets/js/144.a54de9c0.js"><link rel="prefetch" href="/assets/js/145.8714c371.js"><link rel="prefetch" href="/assets/js/146.afd802e8.js"><link rel="prefetch" href="/assets/js/15.5581965d.js"><link rel="prefetch" href="/assets/js/16.36a6df8c.js"><link rel="prefetch" href="/assets/js/17.58419ce3.js"><link rel="prefetch" href="/assets/js/18.78334840.js"><link rel="prefetch" href="/assets/js/19.31ca3599.js"><link rel="prefetch" href="/assets/js/20.55945dbc.js"><link rel="prefetch" href="/assets/js/21.6ddb8d2b.js"><link rel="prefetch" href="/assets/js/22.8d390135.js"><link rel="prefetch" href="/assets/js/23.5d48bf66.js"><link rel="prefetch" href="/assets/js/24.98a3f2a7.js"><link rel="prefetch" href="/assets/js/25.58157085.js"><link rel="prefetch" href="/assets/js/26.f12be7ca.js"><link rel="prefetch" href="/assets/js/27.8b47009c.js"><link rel="prefetch" href="/assets/js/28.94f9feb0.js"><link rel="prefetch" href="/assets/js/29.5b7d2648.js"><link rel="prefetch" href="/assets/js/3.333fb557.js"><link rel="prefetch" href="/assets/js/30.705c0baa.js"><link rel="prefetch" href="/assets/js/31.fdb59e0f.js"><link rel="prefetch" href="/assets/js/32.2383a55b.js"><link rel="prefetch" href="/assets/js/33.bfbec105.js"><link rel="prefetch" href="/assets/js/34.69f76c89.js"><link rel="prefetch" href="/assets/js/35.9f0aa7e6.js"><link rel="prefetch" href="/assets/js/36.02beee59.js"><link rel="prefetch" href="/assets/js/37.19802134.js"><link rel="prefetch" href="/assets/js/38.5653c840.js"><link rel="prefetch" href="/assets/js/39.e3b746fa.js"><link rel="prefetch" href="/assets/js/4.95c43ca0.js"><link rel="prefetch" href="/assets/js/40.96d79a78.js"><link rel="prefetch" href="/assets/js/41.268c3897.js"><link rel="prefetch" href="/assets/js/42.2339675a.js"><link rel="prefetch" href="/assets/js/43.826b5267.js"><link rel="prefetch" href="/assets/js/44.7eabcb79.js"><link rel="prefetch" href="/assets/js/45.e9a3bb83.js"><link rel="prefetch" href="/assets/js/46.7a822972.js"><link rel="prefetch" href="/assets/js/47.5e9b258d.js"><link rel="prefetch" href="/assets/js/48.6db42384.js"><link rel="prefetch" href="/assets/js/49.99deed78.js"><link rel="prefetch" href="/assets/js/5.9d9e1e88.js"><link rel="prefetch" href="/assets/js/50.7829d7c4.js"><link rel="prefetch" href="/assets/js/51.9941a5c2.js"><link rel="prefetch" href="/assets/js/52.c528219a.js"><link rel="prefetch" href="/assets/js/53.b486f5b8.js"><link rel="prefetch" href="/assets/js/54.3590e606.js"><link rel="prefetch" href="/assets/js/55.3f5aa439.js"><link rel="prefetch" href="/assets/js/56.d22c590b.js"><link rel="prefetch" href="/assets/js/57.af5f42f5.js"><link rel="prefetch" href="/assets/js/58.b12ffd2f.js"><link rel="prefetch" href="/assets/js/59.32c30e64.js"><link rel="prefetch" href="/assets/js/60.e8005a21.js"><link rel="prefetch" href="/assets/js/61.322cf604.js"><link rel="prefetch" href="/assets/js/62.c11f3a96.js"><link rel="prefetch" href="/assets/js/63.c5506d7b.js"><link rel="prefetch" href="/assets/js/64.0d80102d.js"><link rel="prefetch" href="/assets/js/65.dfb2d864.js"><link rel="prefetch" href="/assets/js/66.370ef41d.js"><link rel="prefetch" href="/assets/js/67.88c9e001.js"><link rel="prefetch" href="/assets/js/68.f338a0d2.js"><link rel="prefetch" href="/assets/js/69.bdb4c5b0.js"><link rel="prefetch" href="/assets/js/71.88270db3.js"><link rel="prefetch" href="/assets/js/72.dcd32982.js"><link rel="prefetch" href="/assets/js/73.58f68dab.js"><link rel="prefetch" href="/assets/js/74.4ada683a.js"><link rel="prefetch" href="/assets/js/75.a6d32488.js"><link rel="prefetch" href="/assets/js/76.c0d0c351.js"><link rel="prefetch" href="/assets/js/77.5c46677d.js"><link rel="prefetch" href="/assets/js/78.d2e954df.js"><link rel="prefetch" href="/assets/js/79.737ec5f0.js"><link rel="prefetch" href="/assets/js/8.ca781c48.js"><link rel="prefetch" href="/assets/js/80.5d71fe19.js"><link rel="prefetch" href="/assets/js/81.217ef913.js"><link rel="prefetch" href="/assets/js/82.7362843c.js"><link rel="prefetch" href="/assets/js/83.5e90d306.js"><link rel="prefetch" href="/assets/js/84.4420de65.js"><link rel="prefetch" href="/assets/js/85.473092ef.js"><link rel="prefetch" href="/assets/js/86.04701726.js"><link rel="prefetch" href="/assets/js/87.83273b43.js"><link rel="prefetch" href="/assets/js/88.676b6f5c.js"><link rel="prefetch" href="/assets/js/89.9ba0b94d.js"><link rel="prefetch" href="/assets/js/9.13b3374f.js"><link rel="prefetch" href="/assets/js/90.eb51ebaa.js"><link rel="prefetch" href="/assets/js/91.7b0c3d93.js"><link rel="prefetch" href="/assets/js/92.af3e1247.js"><link rel="prefetch" href="/assets/js/93.776e9706.js"><link rel="prefetch" href="/assets/js/94.43b48ebf.js"><link rel="prefetch" href="/assets/js/95.ba8e4bc1.js"><link rel="prefetch" href="/assets/js/96.2fa5d3a3.js"><link rel="prefetch" href="/assets/js/97.1c4f3144.js"><link rel="prefetch" href="/assets/js/98.0c7cbaa6.js"><link rel="prefetch" href="/assets/js/99.b171f0e5.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.73bb25e3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7b19a011.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name" style="margin-left:15px;">Jewelry Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/about.html" class="nav-link">About</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/about.html" class="nav-link">About</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/js" class="sidebar-heading clickable"><span>Javascript</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/fe" class="sidebar-heading clickable router-link-active open"><span>Front-End</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/fe/charles-proxy.html" class="sidebar-link">찰스 프록시 사용하기</a></li><li><a href="/fe/component.html" class="sidebar-link">컴포넌트와 컴포넌트 설계</a></li><li><a href="/fe/cors.html" class="sidebar-link">cors</a></li><li><a href="/fe/csr-ssr.html" class="sidebar-link">CSR, SSR</a></li><li><a href="/fe/css.html" class="sidebar-link">CSS</a></li><li><a href="/fe/jest-snapshot-test.html" class="sidebar-link">Snapshot Test</a></li><li><a href="/fe/optimizing.html" class="sidebar-link">최적화 관련</a></li><li><a href="/fe/pre-render.html" class="sidebar-link">Pre-render</a></li><li><a href="/fe/proxy.html" class="sidebar-link">proxy</a></li><li><a href="/fe/react-auto-batch.html" class="sidebar-link">React Auto Batching</a></li><li><a href="/fe/react-hook-test-jest.html" aria-current="page" class="active sidebar-link">React Hook Test with Jest</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe/react-hook-test-jest.html#테스트할-hook" class="sidebar-link">테스트할 hook</a></li><li class="sidebar-sub-header"><a href="/fe/react-hook-test-jest.html#테스트코드" class="sidebar-link">테스트코드</a></li><li class="sidebar-sub-header"><a href="/fe/react-hook-test-jest.html#또-다른-예제" class="sidebar-link">또 다른 예제</a></li><li class="sidebar-sub-header"><a href="/fe/react-hook-test-jest.html#jest-spyon" class="sidebar-link">jest spyOn</a></li><li class="sidebar-sub-header"><a href="/fe/react-hook-test-jest.html#renderhook-result" class="sidebar-link">renderHook =&gt; result</a></li><li class="sidebar-sub-header"><a href="/fe/react-hook-test-jest.html#waitfornextupdate에서-jest-timeout-떨어지는-경우" class="sidebar-link">waitForNextUpdate에서 jest timeout 떨어지는 경우</a></li></ul></li><li><a href="/fe/react-native.html" class="sidebar-link">React-native</a></li><li><a href="/fe/react-tutorial.html" class="sidebar-link">React Tutorial</a></li><li><a href="/fe/react.html" class="sidebar-link">React</a></li><li><a href="/fe/rxjs.html" class="sidebar-link">RxJS</a></li><li><a href="/fe/scrolltobottom.html" class="sidebar-link">scrollToBottom</a></li><li><a href="/fe/seo-check-point.html" class="sidebar-link">SEO Check Point</a></li><li><a href="/fe/testing-in-mobile.html" class="sidebar-link">모바일 브라우저 테스트 환경설정</a></li><li><a href="/fe/virtual-dom.html" class="sidebar-link">Virtual DOM, Key</a></li><li><a href="/fe/vue-tutorial.html" class="sidebar-link">Vue Tutorial</a></li><li><a href="/fe/watch.html" class="sidebar-link">watch 구현</a></li><li><a href="/fe/web-term.html" class="sidebar-link">웹 관련 용어</a></li><li><a href="/fe/webpack-babel.html" class="sidebar-link">webpack, babel</a></li><li><a href="/fe/webpack-dev-server.html" class="sidebar-link">webpack-dev-server</a></li><li><a href="/fe/webview.html" class="sidebar-link">webview</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/browser" class="sidebar-heading clickable"><span>Web Browser</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/server-side" class="sidebar-heading clickable"><span>Server Side</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/cs" class="sidebar-heading clickable"><span>Computer Science</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/git" class="sidebar-heading clickable"><span>Git</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/design-pattern" class="sidebar-heading clickable"><span>Design Pattern</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/nodejs" class="sidebar-heading clickable"><span>Node.js</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/godot" class="sidebar-heading clickable"><span>godot (고도 게임엔진)</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/tip" class="sidebar-heading clickable"><span>개발 관련 Tip</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="react-hook-test-with-jest"><a href="#react-hook-test-with-jest" class="header-anchor">#</a> React Hook Test with Jest</h1> <p>Jest와 react-testing-library를 사용하여 비즈니스 로직이 포함된 훅을 간편하게(?) 테스트합니다.</p> <p>hook test code를 작성하여 앱 안정성을 보장하려면, 컴포넌트는 하나의 커스텀 훅을 가져야하며,</p> <p>그 커스텀훅에 해당 컴포넌트의 로직이 모두 포함되어있어야 합니다. 내부에서는 또 다른 훅이 존재하겠죠.</p> <p>(그리고 템플릿엔 로직이 없어야합니다.)</p> <p>커스텀 훅에서 리턴된 &quot;모델&quot;을 기반으로 컴포넌트 UI에 붙이기만하면, &quot;모델렌더&quot;를 달성할 수 있습니다.</p> <p>반대로 뷰모델이 분리 안됐다면 테스트코드를 작성하기 힘들어집니다.</p> <p>UI는 우리가 설계한 모델을 기반으로 동작할것이고, 모델과 UI가 확실히 분리되어있어 유지보수하기 좋은 구조입니다.</p> <p>UI는 따로 테스트하거나 스토리북으로 커버하세요.</p> <h2 id="테스트할-hook"><a href="#테스트할-hook" class="header-anchor">#</a> 테스트할 hook</h2> <p>테스트하려는 훅 내부에 useContext와 백엔드 API 호출이 섞여있는 경우를 가정하고 작성해봤습니다.</p> <p>data는 가상의 App 컴포넌트가 렌더링되면 API를 통해 내려오는 좋아요 관련 데이터입니다.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">useProductLike</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> prdNo <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>ProductContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> useState<span class="token operator">&lt;</span>number<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isLiked<span class="token punctuation">,</span> setIsLiked<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> onClickLike <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setIsLiked</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>prev<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">likeProductAPI</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      prdNo<span class="token punctuation">,</span>
      <span class="token literal-property property">isRemove</span><span class="token operator">:</span> isLiked<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> likeCount <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">setCount</span><span class="token punctuation">(</span>likeCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>isLiked<span class="token punctuation">,</span> prdNo<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>data<span class="token operator">?.</span>likeCount <span class="token operator">??</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>data<span class="token operator">?.</span>likeCount<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setIsLiked</span><span class="token punctuation">(</span>data<span class="token operator">?.</span>like<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>data<span class="token operator">?.</span>like<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span> count<span class="token punctuation">,</span> isLiked<span class="token punctuation">,</span> onClickLike <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="테스트코드"><a href="#테스트코드" class="header-anchor">#</a> 테스트코드</h2> <p>아래에서는 상품에 좋아요~ 하는 기능을 담당하는 훅을 테스트합니다.</p> <p>우선 훅 내부에서 호출하는 api를 포함하는 디렉토리를 import합니다.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> api <span class="token keyword">from</span> <span class="token string">'~/apis'</span><span class="token punctuation">;</span>
</code></pre></div><p>그리고 그 디렉토리(user module)를 mocking합니다.</p> <div class="language-js extra-class"><pre class="language-js"><code>jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'~/apis'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">likeProduct</span><span class="token operator">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">likeCount</span><span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>테스트코드에는 서버 API를 직접 호출하는 부분이 있으면 안됩니다.</p> <p>서버 API는 서버에서 테스트해야죠.</p> <p>우리의 테스트는 서버 API 결과와 상관없이 독립적으로 동작해야합니다.</p> <p>그리고 테스트할 훅에서 해당 API가 호출됐는지, 그 후에 훅이 의대로한대로 업데이트 됐는지 확인합니다.</p> <p>@testing-library/react 패키지를 import합니다.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> renderHook <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@testing-library/react-hooks'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> api <span class="token keyword">from</span> <span class="token string">'~/apis'</span><span class="token punctuation">;</span>

jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'~/apis'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">likeProduct</span><span class="token operator">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">likeCount</span><span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> productMock <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...생략</span>
  <span class="token literal-property property">like</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">likeCount</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">like</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'hook testing'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'useProductLike hook'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// hook의 props는 아래와 같이 설정해야한다</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> result<span class="token punctuation">,</span> waitForNextUpdate<span class="token punctuation">,</span> rerender <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">renderHook</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">initialProps</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">useProductLike</span><span class="token punctuation">(</span>initialProps<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> <span class="token literal-property property">initialProps</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">data</span><span class="token operator">:</span> productDetailMock<span class="token punctuation">.</span>like <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// productMock.like의 데이터 =&gt; useProductLike에서 가공하여 반환된 결과들</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>current<span class="token operator">?.</span>isLiked<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>current<span class="token operator">?.</span>count<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// hook 내부에서 likeProduct 함수를 호출하는지 감시할 수 있다.</span>
    <span class="token keyword">const</span> spy <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span>api<span class="token punctuation">,</span> <span class="token string">'likeProduct'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 좋아요에 해당하는 함수 호출</span>
    result<span class="token punctuation">.</span>current<span class="token operator">?.</span><span class="token function">onClickLike</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 렌더링 업데이트를 기다린다</span>
    <span class="token keyword">await</span> <span class="token function">waitForNextUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// hook 내부에서 likeProduct 함수를 호출했는지 체크</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// likeProduct 함수 호출 후 의도한대로 상태가 변경됐는지 확인</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>current<span class="token operator">?.</span>isLiked<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>current<span class="token operator">?.</span>count<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// useEffect hook들을 테스트하기 위해 리렌더</span>
    <span class="token function">rerender</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">like</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">likeCount</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>current<span class="token operator">?.</span>isLiked<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>current<span class="token operator">?.</span>count<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="마지막으로"><a href="#마지막으로" class="header-anchor">#</a> 마지막으로..</h4> <p>이직했는데, 엄청 큰 프로젝트인데도 테스트코드가 하나도 없는 경우가 있어요... 제 얘기 맞습니다 ㅋㅋ</p> <p>잘 쪼개지지 않은 큰 모듈을 테스트할 때, 테스트코드에 필요없는 모듈들에게서 일어나는 황당한 에러들을 많이 겪을 수 있습니다.</p> <p>(큰 모듈엔 많은 import 구문이 있을텐데, 테스트코드에서 사용하지않는 친구들의 코드도 다 실행됩니다)</p> <p>이럴땐 모듈 내부에서 사용하지않는, 내가 테스트할 코드에서 쓸모없는 모듈들을 무시하기 위해 mocking 해버립니다.</p> <div class="language- extra-class"><pre class="language-text"><code>jest.mock('@/components/useless', () =&gt; null);
</code></pre></div><hr> <h2 id="또-다른-예제"><a href="#또-다른-예제" class="header-anchor">#</a> 또 다른 예제</h2> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 테스트용도의 최소한의 useFetch hook 구현체</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> useFetch <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  url <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span>
  autoFetch <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  method <span class="token operator">=</span> <span class="token string">'get'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isLoaded<span class="token punctuation">,</span> setIsLoaded<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">boolean</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> fetchData <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">httpRequest</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
        <span class="token punctuation">[</span>method<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>res<span class="token punctuation">,</span> isLoaded<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">setIsLoaded</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>url<span class="token punctuation">,</span> method<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>autoFetch <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>autoFetch<span class="token punctuation">,</span> data<span class="token punctuation">,</span> fetchData<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> isLoaded<span class="token punctuation">,</span> fetchData <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> api <span class="token keyword">from</span> <span class="token string">'~/apis'</span><span class="token punctuation">;</span>

<span class="token comment">// httpRequest 객체를 mocking 해줍니다.</span>
jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'~/apis'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">httpRequest</span><span class="token operator">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'useFetch'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// url이 없으면 호출하지않습니다.</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'useFetch empty string api =&gt; not fetch'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> result <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">renderHook</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">useFetch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">''</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>current<span class="token operator">?.</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> spy <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span>api<span class="token punctuation">,</span> <span class="token string">'httpRequest'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'useFetch'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> result<span class="token punctuation">,</span> waitForNextUpdate <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">renderHook</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
      <span class="token function">useFetch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'some'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//처음엔 data의 초기값인 null이어야합니다.</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>current<span class="token operator">?.</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token function">waitForNextUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// effect를 기다렸다가,</span>
    <span class="token comment">// 데이터 로드가 끝남을 확인</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>current<span class="token operator">?.</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">isLoaded</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 데이터 로드가 끝났으므로, httpRequest는 1번 호출되어야함</span>
    <span class="token keyword">const</span> spy <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span>api<span class="token punctuation">,</span> <span class="token string">'httpRequest'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 의도적으로 다시 fetch 함수 호출</span>
    result<span class="token punctuation">.</span>current<span class="token operator">?.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token function">waitForNextUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// httpRequest가 한번 더 호출됐는지 확인</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><hr> <h2 id="jest-spyon"><a href="#jest-spyon" class="header-anchor">#</a> jest spyOn</h2> <p>jest의 spy기능은 테스트코드를 더욱 정교하게 만들 수 있도록 도와줍니다.</p> <p>jest.fn와 유사하지만, 테스트코드에서 mocking된 함수 호출을 감시할 수 있습니다.</p> <p>다만 위의 useFetch 예시 2개의 테스트의 순서가 바뀔경우 에러가 발생할 수 있는데,</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> spy <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span>api<span class="token punctuation">,</span> <span class="token string">'httpRequest'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>바로 이 부분을 주의해야합니다.</p> <p>spyOn이 작동할때, 인스턴스가 아닌 내부 변수에 호출 횟수가 캐싱됩니다.</p> <p>그래서 다른 테스트 케이스에서 spyOn의 대상이 되는 함수가 호출됐다면,</p> <p>또 다른 테스트케이스에서 해당 함수를 호출하지않아도 호출횟수가 0이 아닐 수 있습니다.</p> <h2 id="renderhook-result"><a href="#renderhook-result" class="header-anchor">#</a> renderHook =&gt; result</h2> <p>위의 useFetch에서 짚고 넘어가야하는 부분이 있습니다.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> result<span class="token punctuation">,</span> waitForNextUpdate <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">renderHook</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token function">useFetch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token operator">:</span> <span class="token string">'some'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> result<span class="token punctuation">.</span>current <span class="token operator">??</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>이렇게 data를 destructuring 하고싶은 유혹이 드는데요,</p> <p>그 전에 잘 생각해봐야합니다. 왜 result.current 인지.</p> <p>hook 내부의 StateUpdater가 호출되면, result.current.data의 레퍼런스가 변경이 됩니다.</p> <p>하지만 분해해버리면, StateUpdater 실행되고 나서도 실행전의 레퍼런스가 유지됩니다.</p> <p>그래서 hook update 하고나서의 값이 반영되질않죠.</p> <p>사실 이걸 써놓은 이유는 custom hook에서 배열을 리턴하는게 테스트코드의 가독성을 떨어지게 만든다는겁니다.</p> <p>보세요.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>current<span class="token operator">?.</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre></div><p>요런식이 되겠쥬? 그나마 이건 괜찮은데.. 함수인 경우는?</p> <div class="language-js extra-class"><pre class="language-js"><code>result<span class="token punctuation">.</span>current<span class="token operator">?.</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
result<span class="token punctuation">.</span>current<span class="token operator">?.</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
</code></pre></div><p>정말 이대로 괜찮을까요? 저는 useState처럼 이름을 정말 마음대로 자유롭게 짓고 싶은 경우가 아니라면..</p> <p>테스트코드를 위해서라도 훅에서 배열 리턴하지않고 객체 리턴하겠습니다.</p> <h1 id="it-test"><a href="#it-test" class="header-anchor">#</a> it, test</h1> <p>it은 test의 alias입니다. 아무거나 편한거 쓰세요.</p> <h1 id="act-waitfornextupdate"><a href="#act-waitfornextupdate" class="header-anchor">#</a> act, waitForNextUpdate</h1> <p>우선 첫번째 act는 react testing library의 기능이 아닌, react-dom/test-utils 패키지에 포함된 기능입니다.</p> <p>반면 waitForNextUpdate는 renderHook의 인스턴스 메소드입니다.</p> <p>훅 내부에 useEffect를 사용하는 경우입니다.</p> <p>간단한 예시를 들자면,</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">useSomeHook</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setData</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> data<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'useSomeHook'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'useSomeHook'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> result<span class="token punctuation">,</span> waitForNextUpdate <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">renderHook</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">useSomeHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>current<span class="token operator">?.</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token function">waitForNextUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>current<span class="token operator">?.</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>위 예시는 act로 커버하기 어렵습니다.</p> <p>StateUpdater =&gt; waitForNextUpdate</p> <p>DOM Update =&gt; act</p> <p>DOM Update의 예를 들자면.... history.pushState 등이 있겠쥬?</p> <h2 id="waitfornextupdate에서-jest-timeout-떨어지는-경우"><a href="#waitfornextupdate에서-jest-timeout-떨어지는-경우" class="header-anchor">#</a> waitForNextUpdate에서 jest timeout 떨어지는 경우</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>Timeout - Async callback was not invoked within the <span class="token number">5000</span> ms <span class="token function">timeout</span> specified by jest.setTimeout.Timeout - Async callback was not invoked within the <span class="token number">5000</span> ms <span class="token function">timeout</span> specified by jest.setTimeout.Error:
</code></pre></div><p>이 경우는 보통 API등의 함수를 mocking해놓고, 반환값이 제대로 안떨어져서</p> <p>StateUpdater가 실행이 안되는 경우입니다.</p> <p>혹은 비동기함수가 기본타이머 세팅인 5000ms보다 느리게 수행되는경우겠지요</p> <p>이럴땐 타이머를 더 늘려주면 됩니다.</p> <p>가짜 비동기 함수를 만들었다면.. 그 비동기함수를 더 빨리 수행되도록 변경해도 괜찮고요.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/fe/react-auto-batch.html" class="prev">React Auto Batching</a></span> <span class="next"><a href="/fe/react-native.html">React-native</a>
      →
    </span></p></div>  <div id="comment-wrap"><script src="https://utteranc.es/client.js" repo="jewelism/jewelism.github.io" issue-term="React Hook Test with Jest" theme="github-light" crossorigin="anonymous" async="async"></script></div></main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.d8edd250.js" defer></script><script src="/assets/js/2.b813d316.js" defer></script><script src="/assets/js/1.63ec6906.js" defer></script><script src="/assets/js/70.c38e5f80.js" defer></script>
  </body>
</html>
